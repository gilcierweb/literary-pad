<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="mb-8">
    <h1 class="text-4xl font-bold text-gray-900 mb-2">Discover Stories</h1>
    <p class="text-gray-600">Find your next favorite story</p>
  </div>

  <!-- Search & Filters -->
  <div class="card p-6 mb-8">
    <%= form_with url: discover_path, method: :get, class: "space-y-4" do |f| %>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="md:col-span-2">
          <%= f.text_field :q, value: params[:q], placeholder: "Search stories...", class: "input-field" %>
        </div>
        <div>
          <%= f.select :sort,
                       options_for_select([["Most Recent", "recent"], ["Most Popular", "popular"]], params[:sort]),
                       {},
                       class: "input-field" %>
        </div>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Filter by Genre</label>
        <div class="flex flex-wrap gap-2">
          <% @genres.each do |genre| %>
            <%= link_to discover_path(genre_id: genre.id, q: params[:q], sort: params[:sort]),
                        class: "px-4 py-2 rounded-lg text-sm font-medium transition #{params[:genre_id].to_i == genre.id ? 'bg-primary text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}" do %>
              <%= genre.name %>
            <% end %>
          <% end %>
          <% if params[:genre_id].present? %>
            <%= link_to "Clear Filter", discover_path(q: params[:q], sort: params[:sort]), class: "px-4 py-2 rounded-lg text-sm font-medium bg-red-100 text-red-700 hover:bg-red-200 transition" %>
          <% end %>
        </div>
      </div>

      <div class="flex space-x-2">
        <%= f.submit "Search", class: "btn-primary" %>
        <%= link_to "Clear All", discover_path, class: "btn-secondary" %>
      </div>
    <% end %>
  </div>

  <!-- Results -->
  <div class="mb-4">
    <p class="text-gray-600">
      <% if params[:q].present? || params[:genre_id].present? %>
        Showing results
        <% if params[:q].present? %>for "<%= params[:q] %>"<% end %>
        <% if params[:genre_id].present? %>
          in <%= Genre.find(params[:genre_id]).name %>
        <% end %>
      <% else %>
        Showing all stories
      <% end %>
    </p>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
    <% @stories.each do |story| %>
      <%= render "stories/card", story: story %>
    <% end %>
  </div>

  <% if @stories.empty? %>
    <div class="text-center py-16">
      <p class="text-gray-500 text-lg">No stories found matching your criteria.</p>
      <%= link_to "Clear Filters", discover_path, class: "btn-primary mt-4 inline-block" %>
    </div>
  <% end %>

  <div class="mt-8">
    <%== pagy_nav(@pagy) if @pagy.pages > 1 %>
  </div>
</div>