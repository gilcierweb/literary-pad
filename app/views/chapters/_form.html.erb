<%= form_with model: [story, chapter], class: "space-y-6" do |f| %>
  <% if chapter.errors.any? %>
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
      <h3 class="font-bold mb-2"><%= pluralize(chapter.errors.count, "error") %> prohibited this chapter from being saved:</h3>
      <ul class="list-disc list-inside">
        <% chapter.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <%= f.label :title, "Chapter Title", class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= f.text_field :title, class: "input-field", placeholder: "Enter chapter title" %>
  </div>

  <div>
    <%= f.label :content, "Chapter Content", class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= f.text_area :content, rows: 20, class: "input-field font-serif", placeholder: "Write your chapter content here..." %>
    <p class="text-sm text-gray-500 mt-1">
      <span id="word-count">0</span> words
    </p>
  </div>

  <div>
    <%= f.label :position, "Chapter Number", class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= f.number_field :position, class: "input-field", min: 1 %>
  </div>

  <div class="flex space-x-4">
    <%= f.submit class: "btn-primary" %>
    <%= link_to "Cancel", chapter.persisted? ? [story, chapter] : story, class: "btn-secondary" %>
  </div>
<% end %>

<script>
    document.addEventListener('turbo:load', () => {
        const contentField = document.querySelector('textarea[name="chapter[content]"]');
        const wordCountSpan = document.getElementById('word-count');

        if (contentField && wordCountSpan) {
            const updateWordCount = () => {
                const text = contentField.value.trim();
                const wordCount = text ? text.split(/\s+/).length : 0;
                wordCountSpan.textContent = wordCount;
            };

            contentField.addEventListener('input', updateWordCount);
            updateWordCount();
        }
    });
</script>